!function(e){var t={};function a(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,a),s.l=!0,s.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)a.d(n,s,function(t){return e[t]}.bind(null,s));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(e,t,a){e.exports=a(2)},function(e,t,a){},function(e,t,a){"use strict";a.r(t);var n=[{contactId:1,contactName:"Том Круз",contactAvatar:"./img/tom-cruse.jpg",messageHistory:[{messageId:1,isMine:!1,messageText:"Hey, man. Where are you? Call me ASAP",messageTime:"10:14"},{messageId:2,isMine:!1,messageText:"Can we meet for lunch tommorow?",messageTime:"11:00"},{messageId:3,isMine:!0,messageText:"Ok, no problem. When?"}]},{contactId:2,contactName:"Джони Депп",contactAvatar:"./img/jhony-dep.jpeg",messageHistory:[{messageId:1,isMine:!1,messageText:"Hello, I'm Jhony Dep",messageTime:"16:46"},{messageId:2,isMine:!0,messageText:"I know. What do you want?"}]},{contactId:3,contactName:"Мэр",contactAvatar:"./img/mayor.jpg",messageHistory:[{messageId:1,isMine:!0,messageText:"В городе с дорогами всё очень плохо. Что собираетесь делать?",messageTime:"10:46"},{messageId:2,isMine:!1,messageText:"Завтра покупаю себе новый особняк на двадцатом киллометре Свердловского тракта.",messageTime:"11:02"},{messageId:3,isMine:!1,messageText:"Ой. не в тот чат...",messageTime:"11:03"},{messageId:4,isMine:!0,messageText:"А с дорогами то что??",messageTime:"11:25"}]},{contactId:4,contactName:"Цукерберг",contactAvatar:"./img/tsukerberg.jpg",messageHistory:[{messageId:1,isMine:!0,messageText:"Why I can't log in to my facebook account?",messageTime:"9:32"},{messageId:2,isMine:!1,messageText:"Try to reset your password",messageTime:"10:04"},{messageId:3,isMine:!0,messageText:"Ok, thank you!",messageTime:"10:06"},{messageId:4,isMine:!1,messageText:"You're welcome",messageTime:"10:06"}]},{contactId:5,contactName:"Иван Ургант",contactAvatar:"./img/urgant.jpg",messageHistory:[{messageId:1,isMine:!1,messageText:"Здравствуй! Не хочешь поучавствовать в завтрашнем вечернем шоу на Первом канале?",messageTime:"13:32"},{messageId:2,isMine:!1,messageText:"А то Бурунов и Лепс были в прошлый раз, а остальные заняты",messageTime:"13:33"},{messageId:3,isMine:!0,messageText:"Извини, в другой раз. Я тоже занят(",messageTime:"13:48"},{messageId:4,isMine:!1,messageText:"Ладно, придется опять Петрова звать...",messageTime:"13:55"}]}];function s(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i=function(){function e(){var t,a,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n=function(e){localStorage.setItem("chatInfo",JSON.stringify(e))},(a="updateData")in(t=this)?Object.defineProperty(t,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[a]=n,this.chatInfo=JSON.parse(localStorage.getItem("chatInfo"))}var t,a,i;return t=e,(a=[{key:"getData",get:function(){return this.chatInfo?this.chatInfo:n}}])&&s(t.prototype,a),i&&s(t,i),e}();a(1);function c(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var l=new(function(){function e(t){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o(this,"view",null),o(this,"getData",(function(){return a.model.getData})),o(this,"getSpecificChat",(function(e){return a.dbData.find((function(t){return t.contactId==e}))})),o(this,"formatMessageLength",(function(e){var t=e.split(" ");return t.length>15?t.slice(0,10).join(" ")+" ...":e})),o(this,"updateData",(function(e,t){var n=a.dbData.map((function(a){if(a.contactId==t){var n=a.messageHistory[a.messageHistory.length-1].messageId+1;return a.messageHistory.push({messageId:n,isMine:!0,messageText:e}),a}return a}));a.model.updateData(n),a.dbData=n,a.view.clearContactsPage(),a.view.renderContacts(a.dbData)})),this.model=t,this.dbData=this.getData()}var t,a,n;return t=e,(a=[{key:"init",value:function(e){this.view=e}},{key:"getTime",get:function(){var e=new Date,t=e.getHours(),a=e.getMinutes();return t=t<10?"0".concat(t):t,a=a<10?"0".concat(a):a,"".concat(t,":").concat(a)}}])&&r(t.prototype,a),n&&r(t,n),e}())(new i),m=new function e(t){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),c(this,"messanger",document.querySelector(".messanger")),c(this,"chat",document.querySelector(".messanger .messanger__chat")),c(this,"chatBody",document.querySelector(".messanger .messanger__chat .chat__body")),c(this,"newMessage",document.querySelector("#newMessage")),c(this,"filterDialogs",document.querySelector("#filterDialogs")),c(this,"btnSendMessage",document.querySelector(".btn.btn-send")),c(this,"contacts",document.querySelector(".messanger .contacts")),c(this,"chatHeader",document.querySelector(".messanger .chat__header")),c(this,"dbData",null),c(this,"init",(function(){a.dbData=a.presenter.dbData,a.setWindowHeight(),a.renderContacts(a.dbData),a.renderChat(a.dbData[0]),a.eventHandler()})),c(this,"setWindowHeight",(function(){var e=.01*window.innerHeight;a.messanger.style.setProperty("--vh","".concat(e,"px"))})),c(this,"eventHandler",(function(){a.messanger.addEventListener("click",a.messangerClickHandler),a.chat.addEventListener("click",a.chatClickHandler),a.btnSendMessage.addEventListener("click",a.newMessageClickHandler),a.newMessage.addEventListener("keyup",a.newMessageInputHandler),a.filterDialogs.addEventListener("keyup",a.filterHandler),window.addEventListener("resize",a.setWindowHeight)})),c(this,"renderContacts",(function(e){e.forEach((function(e){var t=a.contactRenderTemplate(e);a.contacts.insertAdjacentHTML("beforeend",t)}))})),c(this,"renderChat",(function(e){var t=e,n=a.contactRenderTemplate(t,!0);a.chatHeader.insertAdjacentHTML("beforeend",n),t.messageHistory.forEach((function(e){var t=e.isMine,n=e.messageText,s=e.messageTime,i=void 0===s?a.presenter.getTime:s,c='\n                <div class="chat__messaage '.concat(t?"chat__messaage--mine":"",' d-flex flex-column my-2 p-3">\n                    <div class="message__text">').concat(n,'</div>\n                    <div class="message__time">').concat(i,"</div>\n                </div>\n            ");a.chatBody.insertAdjacentHTML("beforeend",c)}))})),c(this,"clearChatPage",(function(){a.chatHeader.querySelector(".contacts__item").remove();var e=a.chatBody.querySelectorAll(".chat__messaage");[].slice.call(e).forEach((function(e){return e.remove()}))})),c(this,"clearContactsPage",(function(){var e=a.contacts.querySelectorAll(".contacts__item"),t=a.contacts.querySelectorAll(".separator");[].slice.call(t).forEach((function(e){return e.remove()})),[].slice.call(e).forEach((function(e){return e.remove()}))})),c(this,"filterHandler",(function(e){var t=e.target.value.toLowerCase(),n=a.contacts.querySelectorAll(".contacts__item");[].slice.call(n).forEach((function(e){e.querySelector(".contacts__item-name").textContent.toLowerCase().includes(t)?(e.classList.remove("d-none"),e.nextElementSibling.classList.remove("d-none")):(e.classList.add("d-none"),e.nextElementSibling.classList.add("d-none"))}))})),c(this,"newMessageInputHandler",(function(e){13==e.keyCode&&a.newMessageClickHandler()})),c(this,"newMessageClickHandler",(function(){var e=a.newMessage.value;if(e){var t=a.presenter.getTime,n='\n                <div class="chat__messaage chat__messaage--mine my-2 p-3">\n                    <div class="message__text">'.concat(e,'</div>\n                    <div class="message__time">').concat(t,"</div>\n                </div>\n            ");a.chatBody.insertAdjacentHTML("beforeend",n),a.chatBody.scrollTop=document.body.scrollHeight,a.newMessage.value="";var s=a.chatHeader.querySelector(".contacts__item").dataset.id;a.presenter.updateData(e,s)}})),c(this,"messangerClickHandler",(function(e){if(e.target.closest(".contacts__item")){a.chat.classList.add("messanger__chat--open");var t=e.target.closest(".contacts__item").dataset.id,n=a.presenter.getSpecificChat(t);a.clearChatPage(),a.renderChat(n)}})),c(this,"chatClickHandler",(function(e){e.target.closest(".chat__close")&&a.chat.classList.remove("messanger__chat--open")})),c(this,"contactRenderTemplate",(function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.messageHistory,s=e.contactId,i=e.contactAvatar,c=e.contactName,r=n[n.length-1],o=r.messageText,l=r.isMine;o=a.presenter.formatMessageLength(o);var m=l?"<span>Вы: </span>".concat(o):o,d="";return t&&(m="Online",d+="contacts__item-name--dark"),'\n            <div class="contacts__item d-flex p-2" data-id="'.concat(s,'">\n                <div class="contacts__item-logo" style="background-image: url(').concat(i,');"></div>\n                <div class="contacts__item-text d-flex flex-column justify-content-center">\n                    <div class="contacts__item-name ').concat(d,'">').concat(c,'</div>\n                    <div class="contacts__item-message">').concat(m,'</div>\n                </div>\n            </div>\n            <div class="separator my-1"></div>\n        ')})),this.presenter=t,this.init()}(l);l.init(m)}]);